(function(e){function t(t){function w(e,t){t.series.pie.show&&(t.grid.show=!1,t.series.pie.label.show=="auto"&&(t.legend.show?t.series.pie.label.show=!1:t.series.pie.label.show=!0),t.series.pie.radius=="auto"&&(t.series.pie.label.show?t.series.pie.radius=.75:t.series.pie.radius=1),t.series.pie.tilt>1&&(t.series.pie.tilt=1),t.series.pie.tilt<0&&(t.series.pie.tilt=0),e.hooks.processDatapoints.push(N),e.hooks.drawOverlay.push(I),e.hooks.draw.push(A))}function E(e,t){var n=e.getOptions();n.series.pie.show&&n.grid.hoverable&&t.unbind("mousemove").mousemove(D),n.series.pie.show&&n.grid.clickable&&t.unbind("click").click(P)}function S(e){function n(e,r){r||(r=0);for(var i=0;i<e.length;++i){for(var s=0;s<r;s++)t+="	";typeof e[i]=="object"?(t+=""+i+":\n",n(e[i],r+1)):t+=""+i+": "+e[i]+"\n"}}var t="";n(e),alert(t)}function T(e){for(var t=0;t<e.length;++t){var n=parseFloat(e[t].data[0][1]);n&&(l+=n)}}function N(t,i,o,u){v||(v=!0,r=t.getCanvas(),s=e(r).parent(),n=t.getOptions(),t.setData(L(t.getData())))}function C(){d=s.children().filter(".legend").children().width(),o=Math.min(r.width,r.height/n.series.pie.tilt)/2,f=r.height/2+n.series.pie.offset.top,u=r.width/2,n.series.pie.offset.left=="auto"?n.legend.position.match("w")?u+=d/2:u-=d/2:u+=n.series.pie.offset.left,u<o?u=o:u>r.width-o&&(u=r.width-o)}function k(e){for(var t=0;t<e.length;++t)if(typeof e[t].data=="number")e[t].data=[[1,e[t].data]];else if(typeof e[t].data=="undefined"||typeof e[t].data[0]=="undefined")typeof e[t].data!="undefined"&&typeof e[t].data.label!="undefined"&&(e[t].label=e[t].data.label),e[t].data=[[1,0]];return e}function L(e){e=k(e),T(e);var t=0,r=0,i=n.series.pie.combine.color,s=[];for(var o=0;o<e.length;++o)e[o].data[0][1]=parseFloat(e[o].data[0][1]),e[o].data[0][1]||(e[o].data[0][1]=0),e[o].data[0][1]/l<=n.series.pie.combine.threshold?(t+=e[o].data[0][1],r++,i||(i=e[o].color)):s.push({data:[[1,e[o].data[0][1]]],color:e[o].color,label:e[o].label,angle:e[o].data[0][1]*Math.PI*2/l,percent:e[o].data[0][1]/l*100});return r>0&&s.push({data:[[1,t]],color:i,label:n.series.pie.combine.label,angle:t*Math.PI*2/l,percent:t/l*100}),s}function A(t,i){function v(){ctx.clearRect(0,0,r.width,r.height),s.children().filter(".pieLabel, .pieLabelBackground").remove()}function m(){var e=5,t=15,i=10,s=.02;if(n.series.pie.radius>1)var l=n.series.pie.radius;else var l=o*n.series.pie.radius;if(l>=r.width/2-e||l*n.series.pie.tilt>=r.height/2-t||l<=i)return;ctx.save(),ctx.translate(e,t),ctx.globalAlpha=s,ctx.fillStyle="#000",ctx.translate(u,f),ctx.scale(1,n.series.pie.tilt);for(var c=1;c<=i;c++)ctx.beginPath(),ctx.arc(0,0,l,0,Math.PI*2,!1),ctx.fill(),l-=c;ctx.restore()}function g(){function p(n,r,s){if(n<=0)return;s?ctx.fillStyle=r:(ctx.strokeStyle=r,ctx.lineJoin="round"),ctx.beginPath(),Math.abs(n-Math.PI*2)>1e-9?ctx.moveTo(0,0):e.browser.msie&&(n-=1e-4),ctx.arc(0,0,t,i,i+n,!1),ctx.closePath(),i+=n,s?ctx.fill():ctx.stroke()}function d(){function p(t,o,l){if(t.data[0][1]==0)return;var h=n.legend.labelFormatter,p,d=n.series.pie.label.formatter;h?p=h(t.label,t):p=t.label,d&&(p=d(p,t));var v=(o+t.angle+o)/2,m=u+Math.round(Math.cos(v)*i),g=f+Math.round(Math.sin(v)*i)*n.series.pie.tilt,y='<span class="pieLabel" id="pieLabel'+l+'" style="position:absolute;top:'+g+"px;left:"+m+'px;">'+p+"</span>";s.append(y);var w=s.children("#pieLabel"+l),E=g-w.height()/2,S=m-w.width()/2;w.css("top",E),w.css("left",S);if(0-E>0||0-S>0||r.height-(E+w.height())<0||r.width-(S+w.width())<0)c=!0;if(n.series.pie.label.background.opacity!=0){var x=n.series.pie.label.background.color;x==null&&(x=t.color);var T="top:"+E+"px;left:"+S+"px;";e('<div class="pieLabelBackground" style="position:absolute;width:'+w.width()+"px;height:"+w.height()+"px;"+T+"background-color:"+x+';"> </div>').insertBefore(w).css("opacity",n.series.pie.label.background.opacity)}}var t=startAngle;if(n.series.pie.label.radius>1)var i=n.series.pie.label.radius;else var i=o*n.series.pie.label.radius;for(var h=0;h<l.length;++h)l[h].percent>=n.series.pie.label.threshold*100&&p(l[h],t,h),t+=l[h].angle}startAngle=Math.PI*n.series.pie.startAngle;if(n.series.pie.radius>1)var t=n.series.pie.radius;else var t=o*n.series.pie.radius;ctx.save(),ctx.translate(u,f),ctx.scale(1,n.series.pie.tilt),ctx.save();var i=startAngle;for(var h=0;h<l.length;++h)l[h].startAngle=i,p(l[h].angle,l[h].color,!0);ctx.restore(),ctx.save(),ctx.lineWidth=n.series.pie.stroke.width,i=startAngle;for(var h=0;h<l.length;++h)p(l[h].angle,n.series.pie.stroke.color,!1);ctx.restore(),O(ctx),n.series.pie.label.show&&d(),ctx.restore()}if(!s)return;ctx=i,C();var l=t.getData(),d=0;while(c&&d<h)c=!1,d>0&&(o*=p),d+=1,v(),n.series.pie.tilt<=.8&&m(),g();d>=h&&(v(),s.prepend('<div class="error">Could not draw pie with labels contained inside canvas</div>')),t.setSeries&&t.insertLegend&&(t.setSeries(l),t.insertLegend())}function O(e){n.series.pie.innerRadius>0&&(e.save(),innerRadius=n.series.pie.innerRadius>1?n.series.pie.innerRadius:o*n.series.pie.innerRadius,e.globalCompositeOperation="destination-out",e.beginPath(),e.fillStyle=n.series.pie.stroke.color,e.arc(0,0,innerRadius,0,Math.PI*2,!1),e.fill(),e.closePath(),e.restore(),e.save(),e.beginPath(),e.strokeStyle=n.series.pie.stroke.color,e.arc(0,0,innerRadius,0,Math.PI*2,!1),e.stroke(),e.closePath(),e.restore())}function M(e,t){for(var n=!1,r=-1,i=e.length,s=i-1;++r<i;s=r)(e[r][1]<=t[1]&&t[1]<e[s][1]||e[s][1]<=t[1]&&t[1]<e[r][1])&&t[0]<(e[s][0]-e[r][0])*(t[1]-e[r][1])/(e[s][1]-e[r][1])+e[r][0]&&(n=!n);return n}function _(e,n){var r=t.getData(),i=t.getOptions(),s=i.series.pie.radius>1?i.series.pie.radius:o*i.series.pie.radius;for(var a=0;a<r.length;++a){var l=r[a];if(l.pie.show){ctx.save(),ctx.beginPath(),ctx.moveTo(0,0),ctx.arc(0,0,s,l.startAngle,l.startAngle+l.angle,!1),ctx.closePath(),x=e-u,y=n-f;if(ctx.isPointInPath){if(ctx.isPointInPath(e-u,n-f))return ctx.restore(),{datapoint:[l.percent,l.data],dataIndex:0,series:l,seriesIndex:a}}else{p1X=s*Math.cos(l.startAngle),p1Y=s*Math.sin(l.startAngle),p2X=s*Math.cos(l.startAngle+l.angle/4),p2Y=s*Math.sin(l.startAngle+l.angle/4),p3X=s*Math.cos(l.startAngle+l.angle/2),p3Y=s*Math.sin(l.startAngle+l.angle/2),p4X=s*Math.cos(l.startAngle+l.angle/1.5),p4Y=s*Math.sin(l.startAngle+l.angle/1.5),p5X=s*Math.cos(l.startAngle+l.angle),p5Y=s*Math.sin(l.startAngle+l.angle),arrPoly=[[0,0],[p1X,p1Y],[p2X,p2Y],[p3X,p3Y],[p4X,p4Y],[p5X,p5Y]],arrPoint=[x,y];if(M(arrPoly,arrPoint))return ctx.restore(),{datapoint:[l.percent,l.data],dataIndex:0,series:l,seriesIndex:a}}ctx.restore()}}return null}function D(e){H("plothover",e)}function P(e){H("plotclick",e)}function H(e,r){var i=t.offset(),o=parseInt(r.pageX-i.left),u=parseInt(r.pageY-i.top),f=_(o,u);if(n.grid.autoHighlight)for(var l=0;l<g.length;++l){var c=g[l];c.auto==e&&(!f||c.series!=f.series)&&j(c.series)}f&&B(f.series,e);var h={pageX:r.pageX,pageY:r.pageY};s.trigger(e,[h,f])}function B(e,n){typeof e=="number"&&(e=series[e]);var r=F(e);r==-1?(g.push({series:e,auto:n}),t.triggerRedrawOverlay()):n||(g[r].auto=!1)}function j(e){e==null&&(g=[],t.triggerRedrawOverlay()),typeof e=="number"&&(e=series[e]);var n=F(e);n!=-1&&(g.splice(n,1),t.triggerRedrawOverlay())}function F(e){for(var t=0;t<g.length;++t){var n=g[t];if(n.series==e)return t}return-1}function I(e,t){function s(e){if(e.angle<0)return;t.fillStyle="rgba(255, 255, 255, "+n.series.pie.highlight.opacity+")",t.beginPath(),Math.abs(e.angle-Math.PI*2)>1e-9&&t.moveTo(0,0),t.arc(0,0,r,e.startAngle,e.startAngle+e.angle,!1),t.closePath(),t.fill()}var n=e.getOptions(),r=n.series.pie.radius>1?n.series.pie.radius:o*n.series.pie.radius;t.save(),t.translate(u,f),t.scale(1,n.series.pie.tilt);for(i=0;i<g.length;++i)s(g[i].series);O(t),t.restore()}var r=null,s=null,o=null,u=null,f=null,l=0,c=!0,h=10,p=.95,d=0,v=!1,m=!1,g=[];t.hooks.processOptions.push(w),t.hooks.bindEvents.push(E)}var n={series:{pie:{show:!1,radius:"auto",innerRadius:0,startAngle:1.5,tilt:1,offset:{top:0,left:"auto"},stroke:{color:"#FFF",width:1},label:{show:"auto",formatter:function(e,t){return'<div style="font-size:x-small;text-align:center;padding:2px;color:'+t.color+';">'+e+"<br/>"+Math.round(t.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:.5}}}};e.plot.plugins.push({init:t,options:n,name:"pie",version:"1.0"})})(jQuery);