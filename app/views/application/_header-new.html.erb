<!--========= Header starts======------>
<div class="headerwrap">

  <header>
    <div class='logo pull-left'>
      <a href="/" class="brand pull-right"><img src="/assets/emboss-logo-beta.png" alt="" /></a>
    </div>
		
  </header>
</div>

<% if flash[:notice] %>
  <div class="alert alert-success">
    <button type="button" class="close" data-dismiss="alert">
      ×
    </button>
    <%= flash[:notice] %>
  </div>
<% end %>

<% if flash[:error] %>
  <div class="alert alert-error">
    <button type="button" class="close" data-dismiss="alert">
      ×
    </button>
    <%= flash[:error] %>
  </div>
<% end %>

<% if flash[:alert] %>
  <div class="alert">
    <button type="button" class="close" data-dismiss="alert">
      ×
    </button>
    <%= flash[:alert] %>
  </div>
<% end %>

<% if flash[:info] %>
  <div class="alert alert-info">
    <button type="button" class="close" data-dismiss="alert">
      ×
    </button>
    <%= flash[:info] %>
  </div>
<% end %>

<div id="bootstrap-alert-placeholder" class="js-alert"></div>

<script type="script/template" id='search_results_li_tempalte'>
  
  <a class='full-li'>
    <img src='<%%= thumbnail %>'>
    <span>
      <%%= label %>
    </span>
  </a>

</script>


<script type="text/javascript">
$(document).ready(function(){
  $('.notstarwrap').on('click',function(){
    $('.noticontentwrap').slideToggle(600);

    if($('.notstarwrap').hasClass('set_time')){
      app.fn.set_notification_check_time($('.notstarwrap'))
    }
  });

  $('.noteclose').on('click',function(){
    $('.noticontentwrap').slideUp(600);
  });

  $('.usrprev').on('click',function(){
    $('.userprflistwrap').slideToggle(600);
  });


  $('.timeago').timeago()

  // for search
  $.widget( "custom.catcomplete", $.ui.autocomplete, {
      _renderMenu: function( ul, items ) {
        var that = this,
          currentCategory = "";
        $.each( items, function( index, item ) {
          if ( item.category != currentCategory ) {
            ul.append( "<li class='ui-autocomplete-category'>" + item.category + "</li>" );
            currentCategory = item.category;
          }
          that._renderItem( ul, item );
        });
      }
    });


  var on_select_callback = function(item){
    // similar behavior as an HTTP redirect
    window.location.replace(item.url);
  }

  var this_template = _.template( $('#search_results_li_tempalte').html())

  $("#main_header_search").catcomplete({
    delay: 0,
    source: function(request, response){
      $.getJSON( "/main_search?q="+request.term, function(data){
        response(data)
      });
    },
    select: function(event, ui){
      on_select_callback(ui.item)
    },
    messages:{
      noResult: '',
      results: function(){}
    },  
   }).data("custom-catcomplete")._renderItem = function(ul, item){
      return $( "<li>" ).addClass('custom-ui-item clearfix')
            .data( "ui-autocomplete-item", item )
            .append( this_template(item) )
            .appendTo( ul );
    };
});
  
</script>