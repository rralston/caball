<%= javascript_include_tag "users/users_manifest" %>
<%= stylesheet_link_tag "users/show" %>

<!--========= content wrapper======------>
<div class="contentwrap">
  <div class="container-fluid maincontain">
    <div class="row">
  <!--========= Main starts======------>
      <div class="mainwrap span8" >
        <div class="main">
          <div class="row-fluid">
          <!--========= Header ends======------>
              <div class="profhdr span12">
                  
                  <div class="blurbgcover">
                    <div class="blurbg">
                      <img src="<%= @user.cover_photo.image %>" alt="" />
                    </div>
                  </div>
                  
                  <div class="proftagwrap row-fluid">
                    <div class="proftag regular span7 offset5">
                      <p> <%= @user.about %> <%= @user.about %><%= @user.about %><%= @user.about %><%= @user.about %><%= @user.about %></p>
                    </div>
                  </div>
                <div class="profflwwrap row-fluid">
                  
                  <div class="proflwfbg"></div>
                  <div class="profflw span7 offset5">
                    <div class="row-fluid">
                      <div class="flwrs span4">
                        <strong class="regular count"> 
                          <%= @user.followers.count %>
                        </strong>
                        <span class="text light">
                          FOLLOWERS
                        </span>
                      </div>
                      <div class="flwrs span4">
                        <strong class='regular'>
                          <%= @user.friends.count %>
                        </strong>
                        <span class='text light'>
                          FOLLOWING
                        </span>
                      </div>
                      <div class="flwmsg span4">
                        <% if current_user.friends.include?(@user) %>
                          <a class="flw btn btn-follow btn-custom btn-red center-div text-center unfollow" data-friend-id='<%= @user.id %>'>
                            Un Follow
                          </a>
                        <% else %>
                          <a class="flw btn btn-custom btn-red center-div text-center regular btn-follow" data-friend-id='<%= @user.id %>'>
                            Follow
                          </a>
                        <% end %>
                        <a class='msg btn medium send-generic-message' data-message-subject='' data-message-header='Message - <%= @user.name %>' data-message-recipients='<%= @user.email %>'>Message</a>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="profpicwrap img-circle" style="background: url('<%= @user.profile_pic %>') no-repeat">
                  <!---this is the div whose bg is the profile pic -->
                  
                </div>
              </div>
          <!--========= Header ends======------>
          <!--========= Profile name starts======------>
              <div class="profname">
                <div class="row-fluid">
                  <div class="profico">
                    <ul class="picos span4">
                      <li><a href=""><img src="/assets/horn.png" alt="" /></a></li>
                      <li><a href=""><img src="/assets/cut.png" alt="" /></a></li>
                      <li><a class='btn-endorse' data-can='<%= current_user.friends.include?(@user) %>' ><img src="/assets/pencil.png" alt="" /></a></li>
                    </ul>
                  </div>
                </div>
                <div class="row-fluid">
                  <div class="profnm">
                    <div class="profnmh1"><%= @user.name %></div>
                    <div class="profnmh2"><%= @user.location %></div>
                  </div>
                </div>
              </div>
              <div class="skillexp">
                <div class="row-fluid">
                        
                        <ul class="inline libg span12">
                        SKILLS + EXPERTISE:
                          <% @user.expertise.split(',').each do |skill| %>
                            <li class="badge regular"><%= skill %></li>
                          <% end %>
                        </ul>
                </div>
              </div>
          <!--========= Profile name ends======------>


            <div class='row-fluid'>
              <div class='pull-right' id='comments_div'>

              </div>
            </div>

          <!--========= ProfilePost starts======------>
              <div class="postwrap">
                <div class="sortpostwrap">
                  <div class="row-fluid">
                    <div class="sortico">
                      
                      <ul class="picos span5">
                      <li>Sort Updates:</li>
                      <li><a href=""><img src="/assets/sortv.png" alt="" /></a></li>
                      <li><a href=""><img src="/assets/sortp.png" alt="" /></a></li>
                      <li><a href=""><img src="/assets/sortw.png" alt="" /></a></li>
                      </ul>
                    </div>
                  </div>
                </div>
                <div class="row-fluid">
                <div class="postenclose span11 offset1">
                  
                  <div class="row-fluid">
                  <div class="writepost span11 offset1">
                    <div class="sideico"><img src="/assets/writeico.png" alt="" /></div>
                    <textarea name="" id="" cols="30" rows="10"></textarea>
                    <div class="writeico">
                      <ul class="wrtico">
                        <li><img src="/assets/writev.png" alt="" /></li>
                            <li><img src="/assets/writep.png" alt="" /></li>
                      </ul>
                    </div>
                  </div>
                  </div>
                  
                  <div class="row-fluid">
                  <div class="written post">
                    <div class="sideico"><img src="/assets/written.png" alt="" /></div>
                    <div class="publiished postcnt">
                      <div class="postcnth2"><a href="" class=="medium">Stephen Santorum</a> posted a photo <a href="">Stephen Santorum</a></div>
                      <div class="publishedpost postmatter">
                        <p>this is sample post</p>
                      </div>
                      
                      <div class="postftr">
                        <div class="row-fluid">
                          <ul class="pstflw  span3 offset9">
                            <a href="">
                              <li class="cmnt">6</li>
                            </a>
                            <a href="like">
                              <li class="like">51</li>
                            </a>
                          </ul>
                        </div>
                      </div>
                      
                    </div>
                  </div>
                  </div>
                  
                  
                  <div class="row-fluid">
                  <div class="post">
                    <div class="sideico"><img src="/assets/gpost.png" alt="" /></div>
                    <div class="postcnt">
                      <div class="postcnth2"><a href="" class=="medium">Stephen Santorum</a> posted a photo </div>
                      <div class="postmatter">
                        <img src="/assets/postimg.png" alt="" />
                      </div>
                      
                      <div class="postftr">
                        <div class="row-fluid">
                          <ul class="pstflw  span3 offset9">
                            <a href="">
                              <li class="cmnt">6</li>
                            </a>
                            <a href="like">
                              <li class="like">51</li>
                            </a>
                          </ul>
                        </div>
                      </div>
                      
                    </div>
                  </div>
                  </div>
                  <div class="endorse post">
                    <div class="sideico"><img src="/assets/endorse.png" alt="" /></div>
                    <div class="rcvendrs postcnt">
                      <div class="postcnth2"><a href="" class=="medium">Stephen Santorum</a> posted a photo <a href="">Stephen Santorum</a></div>
                      <div class="endrstxt">
                        <p><blockquote>This guy is a pleasure to work with. In aliquam porttitor metus quis bibendum. Nam convallis vestibulum diam vel adipiscing</blockquote></p>
                      
                      </div>
                      <div class="postftr">
                        <div class="row-fluid">
                          <ul class="pstflw  span3 offset9">
                            <a href="">
                              <li class="cmnt">6</li>
                            </a>
                            <a href="like">
                              <li class="like">51</li>
                            </a>
                          </ul>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="post">
                    <div class="sideico"><img src="/assets/gpost.png" alt="" /></div>
                    <div class="postcnt">
                      <div class="postcnth2"><a href="" class=="medium">Stephen Santorum</a> posted a photo </div>
                      <div class="pomatter">
                          <!---vimeo-->
                          <iframe src="http://player.vimeo.com/video/53749030" width="100%" height="330" frameborder="0" ></iframe> <p><a href="http://vimeo.com/53749030">Mia Maestro - Blue Eyed Sailor</a> from <a href="http://vimeo.com/miamaestro">mia maestro</a> on <a href="https://vimeo.com">Vimeo</a>.</p>
                      </div>
                                                    <div class="postftr">
                        <div class="postftr">
                        <div class="row-fluid">
                          <ul class="pstflw  span3 offset9">
                            <a href="">
                              <li class="cmnt">6</li>
                            </a>
                            <a href="like">
                              <li class="like">51</li>
                            </a>
                          </ul>
                        </div>
                      </div>
                      </div>
                    </div>
                  </div>
                  <div class="post">
                    <div class="sideico"><img src="/assets/gpost.png" alt="" /></div>
                    <div class="postcnt">
                      <div class="postcnth2"><a href="" class=="medium">Stephen Santorum</a> posted a photo </div>
                      <div class="pomatter">
                          <!-----vimeo-->
                          <iframe src="http://player.vimeo.com/video/53749030" width="100%" height="330" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe> <p><a href="http://vimeo.com/53749030">Mia Maestro - Blue Eyed Sailor</a> from <a href="http://vimeo.com/miamaestro">mia maestro</a> on <a href="https://vimeo.com">Vimeo</a>.</p>
                      </div>
                                                    <div class="postftr">
                        <div class="postftr">
                        <div class="row-fluid">
                          <ul class="pstflw  span3 offset9">
                            <a href="">
                              <li class="cmnt">6</li>
                            </a>
                            <a href="like">
                              <li class="like">51</li>
                            </a>
                          </ul>
                        </div>
                      </div>
                      </div>
                    </div>
                  </div>
                </div>
                </div>
              </div>
              
          <!--========= ProfilePost starts======-->
          </div>
        </div>
      </div>
  <!--========= Main starts=====-->
  <!--========= Sidebar starts======-->
    <div class="rside span4 right-container">

      <div class='row right-extra-div' id='user_fans_div'>
      </div>

      <div class="row about-div right-extra-div">
        <div class="span4 shrink-div head">
          <span class="pull-left">
            <h3>About</h3>
          </span>
          <span class="btn-show-all pull-right"></span>

        </div>

        <div class="span4">
          <div class="row clearfix">
            <div class="grey-line-divider"></div>
          </div>
        </div>

        <div class="span4 shrink-div desc">
          Cras aliquet lorem eu elit dictum egestas. Donec tellus lectus, ullamcorper quis vehicula sed, iaculis et tellus. Fusce lacus mauris, porta ut turpis ut, accumsan 
        </div>
      </div>

      <div class='row right-extra-div' id='user_projects_div'>
      </div>

      <div class='row right-extra-div' id='user_events_div'>
      </div>

      <div class='row right-extra-div' id='endorsements_div'>
      </div>

  </div>
  <!--=========Sidebar ends======------>
  </div><!--rowfluid-->
</div><!--container fluid-->

<%= render :partial => 'users/templates/blogs' %>
<%= render :partial => 'users/templates/blog' %>
<%= render :partial => 'projects/templates/similar_projects' %>
<%= render :partial => 'projects/templates/similar_project' %>
<%= render :partial => 'users/templates/user_events' %>
<%= render :partial => 'users/templates/user_event' %>
<%= render :partial => 'users/templates/endorsements' %>
<%= render :partial => 'users/templates/endorsement' %>
<%= render :partial => 'users/templates/fans' %>
<%= render :partial => 'users/templates/fan' %>

<%= render :partial => 'users/endorsement_form_modal' %>
<%= render :partial => 'conversations/send_new_message_modal' %>

<script type="text/javascript">
  
  app.current_user = <%= raw current_user.to_json() %>

  app.blogs = new app.collections.blogs()
  app.blogs.reset(<%= raw @user.blogs.to_json(:include => [:user, :likes], :check_user => current_user) %>)
  app.blogs_view = new app.views.blogs({ collection: app.blogs })
  $('#comments_div').html(app.blogs_view.render().el)

  // user projects
  app.user_projects = new app.collections.user_projects()
  app.user_projects.reset(<%= raw @user.projects.to_json(:include => [:comments, :likes, :photos]) %>)
  app.user_projects_view = new app.views.user_projects({ collection: app.user_projects })
  $('#user_projects_div').html(app.user_projects_view.render().el)

  // user events
  app.user_events = new app.collections.user_events()
  app.user_events.reset(<%= raw @user.events.to_json(:include => 
      [
        :main_photo, 
        :start => { :methods => [:pretty_date, :formatted_time] }
      ],
      :methods => [:location_city]) %>)
  app.user_events_view = new app.views.user_events({ collection: app.user_events })
  $('#user_events_div').html(app.user_events_view.render().el)


  // endorsements
  app.endorsements = new app.collections.endorsements()
  app.endorsements.reset(<%= raw @user.received_endorsements.to_json(:include =>:sender) %>)
  app.endorsements_view = new app.views.endorsements({ collection: app.endorsements })
  $('#endorsements_div').html(app.endorsements_view.render().el)

  // fans
  app.user_fans = new app.collections.user_fans()
  app.user_fans.reset(<%= raw @user.followers.to_json() %>)
  app.user_fans_view = new app.views.user_fans({ collection: app.user_fans })
  $('#user_fans_div').html(app.user_fans_view.render().el)

  // listen to the new blog creation event
  $(document).on('newBlog', function(event){
    
    blog = new app.models.blog(event.blog)

    app.blogs.add(blog)
    
    $('#comment_please_wait').hide()
    $('textarea#blog_content').attr('disabled', false).val('')
    $('#blog_video_attributes_url').attr('disabled', false).val('')
    $('#blog_photo_attributes_image').attr('disabled', false)
  });


  // listen to the blog error event event
  $(document).on('blogError', function(event){
    alert(event.message)
    $('#comment_please_wait').hide()
    $('textarea#blog_content').attr('disabled', false)
    $('#blog_video_attributes_url').attr('disabled', false)
    $('#blog_photo_attributes_image').attr('disabled', false)
  });


</script>