<div class='row-fluid'>
  <% @projects.each_with_index do |proj, counter| %>
    <div class='span4 projects-box'>
      <%= link_to project_path(proj.id) do %>
        <h3 class="title centered-text">
          <span><%= proj.title %></span>
        </h3>
      <% end %>
      <div class="row-fluid">
        <%= link_to project_path(proj.id) do %>
          <div class='thumbnail-figure span6'>
            <% if proj.photos.exists? %>
            <%= image_tag(proj.photos.first.image.url(:medium), :class => "profile-image") %>
            <% end %>
          </div>
        <% end %>
        <div class="name-location span6">
          <h5> <span><%= User.find(proj.user_id).name %></span></h5>
          <span class="location"><%= if proj.location.present? then proj.location end%></span>
          <span class="open-roles"><%= proj.roles.length %> Open Roles </span>
          <div class="message-button-container">
            <a data-toggle="modal" data-target="#message-modal" 
                  data-remote ="<%= new_conversation_path(:recipient => User.find(proj.user_id).email, :modal => true)%>"
                  data-keyboard="true" class="message-button">Message</a>
            <!-- Message Modal -->
              <div id="message-modal" class="modal hide fade left-aligned" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                  <h3><span>Message <%= User.find(proj.user_id).name.split[0..0].join(" ") %></span></h3>
                </div>
                <div class="modal-body">
                </div>
              </div>
            <!-- Message Modal --> 
          </div>
        </div>
      </div>
      <div class='thumbnail-details'>
        <div class="project-description">
          <%= shorten :text => proj.description, :length => 100, :partial => "more_projects_description.html.erb", :counter => counter %>
        </div>
        <div class="row-fluid roles-container centered-text">
          <% proj.roles.each_with_index do |role, index| %>
            <% if index > 7 then %>
              <%= proj.roles.length - index %> more roles available!
              <% break %>
            <% end %>
            <span class="role-name"><%= role.name %></span>
          <% end %>
        </div>
        
      </div>
      <!-- Projects Description Modal -->
      <div id="projects-description-<%= counter %>" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
          <h3><span><%= proj.title %></span></h3>
        </div>
        <div class="modal-body">
          <p>
            <%= simple_format(proj.description) %>
          </p>
        </div>
      </div>
      <!-- End Projects Description Modal -->
    </div>
  <% end %>
</div>